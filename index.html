<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#111827">
    <title>Sure | Financial Dashboard (India)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg-body: #111827; --text-main: #F9FAFB; --text-muted: #9CA3AF; --accent: #3B82F6; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); -webkit-tap-highlight-color: transparent; }
        
        /* Glass UI */
        .glass-panel { background: rgba(31, 41, 55, 0.7); border: 1px solid rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        
        /* Transitions */
        .view-section { display: none; padding-bottom: 80px; }
        .view-section.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Nav Active States */
        .nav-item.active { color: #3B82F6; }
        .desktop-nav-item.active { background: rgba(255,255,255,0.05); color: white; border-right: 3px solid #3B82F6; }

        .chart-wrapper { position: relative; height: 250px; width: 100%; }
        ::-webkit-scrollbar { width: 6px; } 
        ::-webkit-scrollbar-track { background: #111827; } 
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden selection:bg-blue-500 selection:text-white">

    <!-- AUTH OVERLAY -->
    <div id="auth-overlay" class="fixed inset-0 z-50 bg-[#111827] flex flex-col items-center justify-center p-6">
        <div class="glass-panel p-8 rounded-2xl max-w-sm w-full text-center shadow-2xl">
            <h1 class="text-4xl font-bold text-white mb-2">Sure.</h1>
            <p class="text-gray-400 mb-8 text-sm">Cloud Finance Dashboard</p>
            <button id="btn-login" class="w-full bg-white text-gray-900 font-bold py-3.5 rounded-xl hover:bg-gray-100 transition flex items-center justify-center gap-3 shadow-lg">
                <i class="fab fa-google text-lg"></i> Continue with Google
            </button>
            <p id="auth-status" class="text-xs text-rose-400 mt-4 min-h-[1rem]"></p>
        </div>
    </div>

    <!-- SIDEBAR (Desktop) -->
    <aside class="hidden md:flex flex-col w-64 bg-gray-900 border-r border-white/5 z-20">
        <div class="p-6 text-xl font-bold tracking-tight text-white flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white"><i class="fas fa-bolt"></i></div> Sure.
        </div>
        <nav class="flex-1 px-4 space-y-2 mt-4">
            <button onclick="router('dashboard')" id="d-nav-dashboard" class="desktop-nav-item w-full flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-r-lg text-left gap-3"><i class="fas fa-chart-pie w-5"></i> Dashboard</button>
            <button onclick="router('accounts')" id="d-nav-accounts" class="desktop-nav-item w-full flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-r-lg text-left gap-3"><i class="fas fa-wallet w-5"></i> Accounts</button>
            <button onclick="router('transactions')" id="d-nav-transactions" class="desktop-nav-item w-full flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-r-lg text-left gap-3"><i class="fas fa-list w-5"></i> Transactions</button>
        </nav>
        <div class="p-4 border-t border-white/5">
            <div class="flex items-center gap-3 mb-3">
                <img id="user-avatar" src="" class="w-9 h-9 rounded-full bg-gray-700 hidden border border-white/10">
                <div class="overflow-hidden">
                    <div id="user-name" class="text-sm font-medium text-white truncate">User</div>
                    <div class="text-[10px] text-emerald-500 flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span> Sync Active</div>
                </div>
            </div>
            <button id="btn-logout" class="w-full py-2 text-xs text-rose-400 bg-rose-500/10 hover:bg-rose-500/20 rounded border border-rose-500/20 transition">Sign Out</button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 relative flex flex-col h-full overflow-hidden bg-[#0B1120]">
        <!-- Mobile Header -->
        <header class="md:hidden flex items-center justify-between p-4 bg-gray-900/80 backdrop-blur-md border-b border-white/5 z-30 sticky top-0">
            <div class="flex items-center gap-2">
                <div class="w-6 h-6 bg-blue-600 rounded flex items-center justify-center text-white text-xs"><i class="fas fa-bolt"></i></div>
                <span class="font-bold text-lg text-white">Sure.</span>
            </div>
            <div id="mob-sync-status" class="w-2 h-2 rounded-full bg-emerald-500"></div>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view-section flex-1 overflow-y-auto p-4 md:p-8">
            <div class="max-w-5xl mx-auto space-y-6">
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white">Overview</h2>
                        <p class="text-gray-400 text-sm mt-1">Real-time cloud sync</p>
                    </div>
                    <div class="glass-panel px-5 py-3 rounded-xl border-l-4 border-blue-500">
                        <div class="text-xs text-gray-400 uppercase tracking-wider">Net Worth</div>
                        <div class="text-3xl font-bold text-white" id="dash-networth">...</div>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-1">
                    <div class="p-5 pb-0 flex justify-between items-center"><h3 class="font-medium text-gray-200">History</h3></div>
                    <div class="chart-wrapper p-4"><canvas id="mainChart"></canvas></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="glass-panel p-5 rounded-2xl">
                        <div class="text-xs text-gray-400">Total Assets</div>
                        <div class="text-xl md:text-2xl font-bold text-white mt-1" id="dash-assets">...</div>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl">
                        <div class="text-xs text-gray-400">Total Debts</div>
                        <div class="text-xl md:text-2xl font-bold text-white mt-1" id="dash-debts">...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACCOUNTS VIEW -->
        <div id="view-accounts" class="view-section flex-1 overflow-y-auto p-4 md:p-8">
            <div class="max-w-3xl mx-auto">
                <div class="flex justify-between items-center mb-6 sticky top-0 md:static z-10 py-2">
                    <h2 class="text-2xl font-bold text-white">Accounts</h2>
                    <button onclick="openModal('accountModal')" class="bg-blue-600 hover:bg-blue-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-plus"></i></button>
                </div>
                <div id="accounts-container" class="space-y-6 pb-20"></div>
            </div>
        </div>

        <!-- TRANSACTIONS VIEW -->
        <div id="view-transactions" class="view-section flex-1 overflow-y-auto p-4 md:p-8">
            <div class="max-w-4xl mx-auto h-full flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">Activity</h2>
                    <button onclick="openModal('txModal')" class="bg-blue-600 hover:bg-blue-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-plus"></i></button>
                </div>
                <div class="glass-panel rounded-2xl flex-1 flex flex-col overflow-hidden">
                    <div class="p-3 border-b border-white/5">
                        <input type="text" id="tx-search" placeholder="Search..." onkeyup="renderTransactions()" class="bg-gray-900/50 border border-white/10 rounded-xl px-4 py-2 text-sm text-white w-full focus:outline-none focus:border-blue-500">
                    </div>
                    <div id="full-tx-list" class="overflow-y-auto flex-1 divide-y divide-white/5 pb-20"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- MOBILE NAV -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-gray-900/90 backdrop-blur-xl border-t border-white/10 pb-safe z-40">
        <div class="flex justify-around items-center h-16">
            <button onclick="router('dashboard')" id="m-nav-dashboard" class="nav-item flex flex-col items-center gap-1 text-gray-500 w-full h-full justify-center"><i class="fas fa-chart-pie text-lg"></i><span class="text-[10px]">Overview</span></button>
            <button onclick="router('accounts')" id="m-nav-accounts" class="nav-item flex flex-col items-center gap-1 text-gray-500 w-full h-full justify-center"><i class="fas fa-wallet text-lg"></i><span class="text-[10px]">Accounts</span></button>
            <button onclick="router('transactions')" id="m-nav-transactions" class="nav-item flex flex-col items-center gap-1 text-gray-500 w-full h-full justify-center"><i class="fas fa-list text-lg"></i><span class="text-[10px]">Activity</span></button>
            <button id="mob-btn-logout" class="flex flex-col items-center gap-1 text-gray-500 w-full h-full justify-center"><i class="fas fa-sign-out-alt text-lg"></i><span class="text-[10px]">Logout</span></button>
        </div>
    </nav>

    <!-- MODALS -->
    <div id="accountModal" class="fixed inset-0 z-50 hidden bg-black/90 backdrop-blur-sm flex items-end md:items-center justify-center sm:p-4">
        <div class="bg-gray-800 rounded-t-2xl md:rounded-2xl border border-white/10 p-6 w-full max-w-md">
            <h3 class="text-xl font-bold text-white mb-4">Add Account</h3>
            <form onsubmit="addAccount(event)" class="space-y-4">
                <input type="text" id="accName" required class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white" placeholder="Account Name">
                <input type="number" step="1" id="accBalance" required class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white" placeholder="0">
                <select id="accType" class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white">
                    <option value="cash">Cash/Bank</option><option value="investment">Investment</option><option value="property">Property</option><option value="credit">Debt/Credit</option>
                </select>
                <div class="flex gap-2">
                    <button type="button" onclick="closeModal('accountModal')" class="w-1/3 text-gray-400">Cancel</button>
                    <button type="submit" class="w-2/3 bg-blue-600 text-white font-bold rounded-xl py-3">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="txModal" class="fixed inset-0 z-50 hidden bg-black/90 backdrop-blur-sm flex items-end md:items-center justify-center sm:p-4">
        <div class="bg-gray-800 rounded-t-2xl md:rounded-2xl border border-white/10 p-6 w-full max-w-md">
            <h3 class="text-xl font-bold text-white mb-4">Log Transaction</h3>
            <form onsubmit="addTransaction(event)" class="space-y-4">
                <input type="text" id="txDesc" required class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white" placeholder="Description">
                <div class="grid grid-cols-2 gap-3"><input type="number" step="1" id="txAmount" required class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white" placeholder="0"><input type="date" id="txDate" required class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white"></div>
                <select id="txType" class="w-full bg-gray-900 border border-white/10 rounded-xl p-3 text-white"><option value="expense">Expense</option><option value="income">Income</option></select>
                <div class="flex gap-2">
                    <button type="button" onclick="closeModal('txModal')" class="w-1/3 text-gray-400">Cancel</button>
                    <button type="submit" class="w-2/3 bg-blue-600 text-white font-bold rounded-xl py-3">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- FIREBASE LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // YOUR CONFIGURATION KEYS
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDVCcds_UxopRp6Vw3vL0YYzr9IjIjR6Lc",
            authDomain: "expense-and-income-faf13.firebaseapp.com",
            projectId: "expense-and-income-faf13",
            storageBucket: "expense-and-income-faf13.firebasestorage.app",
            messagingSenderId: "1278622168",
            appId: "1:1278622168:web:b6e94a4d440d17d7b75aad"
        };
        // ==========================================

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        let currentUser = null;
        let state = { accounts: [], transactions: [], history: [0] };
        let chartInst = null;

        // UI Refs
        const els = {
            overlay: document.getElementById('auth-overlay'),
            status: document.getElementById('auth-status'),
            name: document.getElementById('user-name'),
            avatar: document.getElementById('user-avatar'),
            nw: document.getElementById('dash-networth'),
            as: document.getElementById('dash-assets'),
            db: document.getElementById('dash-debts')
        };

        // Auth
        document.getElementById('btn-login').onclick = async () => {
            els.status.innerText = "Connecting...";
            try { await signInWithPopup(auth, provider); } catch(e) { els.status.innerText = e.message; }
        };
        const logout = () => signOut(auth);
        document.getElementById('btn-logout').onclick = logout;
        document.getElementById('mob-btn-logout').onclick = logout;

        onAuthStateChanged(auth, (user) => {
            if(user) {
                currentUser = user;
                els.overlay.classList.add('hidden');
                els.name.innerText = user.displayName;
                els.avatar.src = user.photoURL;
                els.avatar.classList.remove('hidden');
                initSync();
            } else {
                currentUser = null;
                els.overlay.classList.remove('hidden');
                els.status.innerText = "";
            }
        });

        // Sync
        function initSync() {
            onSnapshot(doc(db, "users", currentUser.uid), (doc) => {
                if(doc.exists()) {
                    state = doc.data();
                    render();
                    document.getElementById('mob-sync-status').classList.add('animate-ping');
                    setTimeout(()=>document.getElementById('mob-sync-status').classList.remove('animate-ping'), 1000);
                } else {
                    save(); // Init
                }
            });
        }
        async function save() { if(currentUser) await setDoc(doc(db, "users", currentUser.uid), state); }

        // Logic
        window.addAccount = (e) => {
            e.preventDefault();
            state.accounts.push({
                id: Date.now(),
                name: document.getElementById('accName').value,
                balance: parseFloat(document.getElementById('accBalance').value),
                type: document.getElementById('accType').value
            });
            save(); closeModal('accountModal'); e.target.reset();
        };

        window.addTransaction = (e) => {
            e.preventDefault();
            state.transactions.unshift({
                id: Date.now(),
                desc: document.getElementById('txDesc').value,
                amount: parseFloat(document.getElementById('txAmount').value),
                date: document.getElementById('txDate').value,
                type: document.getElementById('txType').value
            });
            save(); closeModal('txModal'); e.target.reset();
        };

        window.deleteItem = (list, id) => {
            if(confirm('Delete item?')) { state[list] = state[list].filter(i=>i.id!==id); save(); }
        };

        // Render with INDIAN RUPEE FORMATTING
        const money = (n) => new Intl.NumberFormat('en-IN', { 
            style: 'currency', 
            currency: 'INR', 
            maximumFractionDigits: 0 
        }).format(n);

        function render() {
            let assets = 0, debts = 0;
            state.accounts.forEach(a => {
                if(['cash','investment','property'].includes(a.type)) assets += a.balance;
                else debts += a.balance;
            });
            const nw = assets - debts;

            els.nw.innerText = money(nw);
            els.as.innerText = money(assets);
            els.db.innerText = money(debts);

            // Chart
            if(state.history[state.history.length-1] !== nw) {
                state.history.push(nw);
                if(state.history.length > 12) state.history.shift();
            }
            const ctx = document.getElementById('mainChart').getContext('2d');
            if(chartInst) chartInst.destroy();
            chartInst = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(state.history.length).fill(''),
                    datasets: [{ data: state.history, borderColor: '#3B82F6', backgroundColor: 'rgba(59, 130, 246, 0.1)', borderWidth: 3, fill: true, tension: 0.4, pointRadius: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });

            // Accounts
            const ac = document.getElementById('accounts-container'); ac.innerHTML = '';
            const groups = { 'Liquidity': 'cash', 'Investments': 'investment', 'Properties': 'property', 'Debts': ['credit','loan'] };
            for(const [name, types] of Object.entries(groups)) {
                const items = state.accounts.filter(a => Array.isArray(types) ? types.includes(a.type) : a.type === types);
                if(items.length) {
                    let h = `<div class="glass-panel rounded-2xl overflow-hidden mb-4"><div class="bg-gray-800/30 p-3 text-xs font-bold text-gray-400 uppercase pl-5">${name}</div><div class="divide-y divide-white/5">`;
                    items.forEach(i => {
                        h += `<div class="p-4 flex justify-between items-center hover:bg-white/5 group"><span class="text-white font-medium text-sm">${i.name}</span><div class="flex gap-3"><span class="text-white">${money(i.balance)}</span><button onclick="deleteItem('accounts', ${i.id})" class="text-rose-500 opacity-50 hover:opacity-100"><i class="fas fa-trash"></i></button></div></div>`;
                    });
                    ac.innerHTML += h + `</div></div>`;
                }
            }

            // Tx
            const tc = document.getElementById('full-tx-list'); tc.innerHTML = '';
            const term = document.getElementById('tx-search').value.toLowerCase();
            state.transactions.filter(t=>t.desc.toLowerCase().includes(term)).forEach(t => {
                const isInc = t.type === 'income';
                tc.innerHTML += `<div class="flex justify-between items-center p-4 hover:bg-white/5"><div class="flex gap-3"><div class="flex flex-col"><span class="text-white text-sm font-medium">${t.desc}</span><span class="text-xs text-gray-500">${t.date}</span></div></div><div class="flex gap-3"><span class="${isInc?'text-emerald-400':'text-white'} font-medium text-sm">${isInc?'+':'-'}${money(t.amount)}</span><button onclick="deleteItem('transactions', ${t.id})" class="text-gray-600 hover:text-rose-500"><i class="fas fa-times"></i></button></div></div>`;
            });
        }

        // Nav
        window.router = (v) => {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
            document.querySelectorAll('.nav-item, .desktop-nav-item').forEach(e => e.classList.remove('active'));
            if(document.getElementById('d-nav-'+v)) document.getElementById('d-nav-'+v).classList.add('active');
            if(document.getElementById('m-nav-'+v)) document.getElementById('m-nav-'+v).classList.add('active');
        };
        window.openModal = (id) => document.getElementById(id).classList.remove('hidden');
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        
        document.getElementById('txDate').valueAsDate = new Date();
        router('dashboard');
    </script>
</body>
</html>
